# Выбор решения по согласования выгрузки данных в ПП890 и Крону

* Status: proposed
* Date: 2024-01-08

Technical Story: support.it-serv.ru/bugnet/Issues/IssueDetail.aspx?id=60040

## Context and Problem Statement

В рамках базовой поставки АИС Омниус был разработан функционал передачи точек поставки в АС Крона. Точки поставки передаются по определенному формату, которым предусмотрено в поле F_OBJ_ID передать код АС Крона объекта электросетевого хозяйства (далее - ЭСХ). 

В случае, если потребитель подключает к сети Россети Урал объект ЭСХ, при передаче такой точки поставки в поле F_OBJ_ID должен быть передан код Кроны подключаемого объекта ЭСХ потребителя. Для этих целей было рекомендовано в рамках импорта данных и в рамках ведения точек поставки в подключении сети указывать узел сети = объекту ЭСХ потребителя. Например, если потребитель подключает к сети Россети Урал линию, то в подключении должна быть указана эта линия. 

19.12.2023 состоялись приемо-сдаточные испытания функциональности ППРФ890, на испытаниях отметили, что в рамках ППРФ890 в подключении к сети всегда должен быть указан объект Россети Урал, что противоречит разработанной функциональности передачи точек поставки в Крону и рекомендациям по импорту данных и ведению  точек поставки в Омниус вручную. 

Текущая реализация
Алгоритм выгрузки кода Кроны (ED_Network_Items.string4):
1. Если потребитель присоединяет к сети ЭПУ (цех, гараж, магазин, дом и т.п), код Кроны будет равен коду линии или подстанции, которые указаны в узле сети
2. Если потребитель присоединяет к сети не ЭПУ, а ЭСХ (линию или подстанцию), код Кроны должен быть равен коду Крону объекта ЭСХ потребителя, т.е. код Кроны линии или подстанции потребителя, которые присоединены к сети МРСК.
3. Если в узел сети или на ЭСХ потребителя нет кода Кроны или Код Кроны = значению, начинающемуся со слов "Сопоставление с АС "Крона" не требуется", в этом случае следует выполнить поиск кода Кроны по схеме сети "вверх" и вывести первый найденный код Кроны. Например, по алгоритму пп.1-2 в поле должен быть передан код Кроны линии, но в Омниус код Кроны для линии не указан, "вверх" по схеме сети должна быть найдена подстанция и выведен код Кроны подстанции, если и на подстанции нет кода Кроны, то снова "вверх" по схеме сети находим линию ВН и при наличии на ней кода Кроны выводим Код Кроны этой линии ВН.

## Decision Drivers

* согласно концепции 890 существуют след типы точек поставок
* Субъект №1 – субъект, владелец электросетевого хозяйства, от которого в точку поставки осуществляется переток Э/Э.
Субъект №2 – субъект (потребитель) в точку поставки которого осуществляется переток Э/Э
СО – Присоединенная сетевая организация, к которой присоединены (в том числе опосредованно) ЭПУ потребителя.
ТСО – Территориальная сетевая организация, оказывающая услуги по передаче Э/Э
ГП – гарантирующий поставщик Э/Э
* ТоП5 – Отдача потребителю РЭС ПЭС.
    Метод выявления точки поставки:

    Учетный показатель с показателем баланса с типом ТоП5 из таблицы «Детализация показателей баланса».

    Методы выявления контрагентов для данного типа ТоП:
    Субъект 1 – контрагент владелец сечения учета,
    Субъект 2 – контрагент для точки учета потребителя,
    СО – отсутствует,
    ТСО – контрагент балансовой принадлежности элемента сети в точке поставки,
    ГП – контрагент поставщик ЭСК из точки поставки.
* Из вопроса следует что точки подключены к потребительскому оборудованию
В балансовой принадлежности элемента сети в точке поставки, необходимо указать конкретного потребителя
ЭСХ потребителей в АС Кроне ведутся и имеют битовый признак а так же информацию о принадлежности к КА

## Considered Options

* выполнить апдейт данных по балансовой принадлежности элементов схемы сети - по всему потребительскому оборудованию заполнить балансовую принадлежность

## Decision Outcome

Chosen option: "выполнить апдейт данных по балансовой принадлежности элементов схемы сети", because единственный вариант

## Pros and Cons of the Options

### выполнить апдейт данных по балансовой принадлежности элементов схемы сети

определить какие узлы ЭСХ являются потребительскими по данным миграции/первичного импорта или АС Крона "признак принадлежности потребителю" (extPowerObject=1)
    Запросить данные из АС Крона по указанным узлам - "ИД управляющей организации" (erpOrgGUID), "наименование управляющей организации" (erpOrgName)
    выполнить апдейт данных по балансовой принадлежности элементов схемы сети - по всему потребительскому оборудованию заполнить балансовую принадлежность

## Links

* http://tfs2017.compulink.local:8080/tfs/DefaultCollection/IServ.eOmniUSApi/_git/IAS%20REST%20DOC?path=%2F%D0%A2%D0%B5%D1%85%D0%BD%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B5%20%D1%81%D0%BE%D0%B3%D0%BB%D0%B0%D1%88%D0%B5%D0%BD%D0%B8%D0%B5%2F%D0%9F%D0%BE%D1%8F%D1%81%D0%BD%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F%20%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D0%BA%D0%B0%20%D0%BA%20%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20890%20%D0%9F%D0%9F%D0%A0%D0%A4%20%D0%B2%D0%B5%D1%80%2019.12.doc
